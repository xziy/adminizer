<select name="<%= key %>" data-placeholder="Select item"
        id="form-<%= key %>" <%= field.config.required ? 'required' : '' %> <%= field.config.disabled ? 'disabled' : '' %>>
</select>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let choices = [{value: '', label: 'Nothing selected'}]
        <% for (let opt of field.config.records) { %>
        choices.push({
            label: '<%- field.config.displayModifier && typeof field.config.displayModifier === 'function'
                    ? field.config.displayModifier(opt)
                    : (field.config.displayField ? opt[field.config.displayField] : opt[field.config.identifierField]); %>',
            value: '<%= opt[field.config.identifierField] %>',
            selected: <%- opt[field.config.identifierField] === value %>
        })
        <% } %>

        const assoc = new Choices('#form-<%= key %>', {
            choices: choices,
            removeItemButton: true
        });

        assoc.passedElement.element.addEventListener(
            'removeItem',
            function (event) {
                assoc.setChoiceByValue('')
            },
            false,
        );
    })
</script>
