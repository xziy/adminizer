> ⚠️ **AI-DRAFT**
>
> This document was generated by a neural network and may contain inaccuracies or mistakes.

# Next.js + Adminizer (`nyachik-connect` case)

## Scope

This page summarizes a production integration of Adminizer into a Next.js application with Sequelize + SQLite.

Source commits used for reconstruction:

- `36ea9f5` — `feat: add sequelize data layer and adminizer`
- `15d2c6f` — `test: ensure adminizer route prefix`

## What was added

1. Installed Adminizer + Sequelize + SQLite dependencies.
2. Updated `next.config.mjs` for server runtime compatibility.
3. Added singleton Sequelize initialization and model registration.
4. Added singleton Adminizer bootstrap in `src/server/adminizer/index.ts`.
5. Added Adminizer UI config in `src/server/adminizer/config.ts`.
6. Added catch-all API route `src/pages/api/adminizer/[[...adminizer]].ts`.
7. Added a Vitest assertion for `routePrefix = "/adminizer"`.

## 1) Install dependencies

```bash
npm install adminizer sequelize sqlite3
npm install -D @types/sqlite3 vitest
```

## 2) Configure Next.js runtime

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  experimental: {
    typedRoutes: true,
    serverComponentsExternalPackages: ["sequelize", "sqlite3", "adminizer"],
  },
  outputFileTracingIncludes: {
    "/*": [
      "./node_modules/sqlite3/build/Release/**/*",
      "./node_modules/sqlite3/lib/binding/**/*",
      "./src/lib/**/*",
      "./src/server/adminizer/**/*",
    ],
  },
};

export default nextConfig;
```

Why this matters:

- `serverComponentsExternalPackages` avoids bundling issues for native ORM/runtime packages.
- `outputFileTracingIncludes` ensures SQLite native bindings and Adminizer server files are present in build output.

## 3) Add DB and Adminizer singletons

Use a singleton Sequelize connector and call `SequelizeAdapter.registerSystemModels(orm)` before `adminizer.init(...)`.

Recommended shape:

- `src/lib/sequelize.ts`: creates and caches Sequelize instance.
- `src/lib/models/index.ts`: initializes custom models and relations.
- `src/server/adminizer/index.ts`: creates and caches Adminizer instance.
- `src/server/adminizer/config.ts`: stores `routePrefix`, model mapping, and UI field config.

## 4) Add catch-all API route

Create `src/pages/api/adminizer/[[...adminizer]].ts` and proxy requests to Adminizer middleware:

```ts
import type { NextApiRequest, NextApiResponse } from "next";
import { getAdminizerMiddleware } from "@/server/adminizer";

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const middleware = await getAdminizerMiddleware();

  await new Promise<void>((resolve, reject) => {
    middleware(req as any, res as any, (err?: unknown) => {
      if (err) return reject(err);
      resolve();
    });
  });
}
```

## 5) Add a route prefix test

```ts
import { describe, expect, test } from "vitest";
import { adminizerConfig } from "@/server/adminizer/config";

describe("adminizer route prefix", () => {
  test("should be /adminizer", () => {
    expect(adminizerConfig.routePrefix).toBe("/adminizer");
  });
});
```

## Verification checklist

- Start app in dev mode and open `/adminizer`.
- Ensure list pages load and CRUD works for a sample model.
- Build production bundle and run it.
- Run route prefix test.

## Related guide

- [Nuxt 3 Framework Guide](./nuxt3.md)
