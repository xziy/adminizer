# Фаза 14: Выбор полей (Field Selection)

## Приоритет: P2
## Статус: Не начата
## Зависимости: Фаза 2, 3, 4

> Примеры ниже — псевдокод в стиле TypeScript. Реализацию адаптируйте под архитектуру проекта.

---

## Описание

Функционал выбора полей для запросов (аналог `attributes` в Sequelize). Пользователь указывает, какие поля загружать из базы данных, чтобы уменьшить объём данных и улучшить производительность. Выбранные поля сохраняются в фильтрах и автоматически применяются при выполнении запросов.

---

## Цели

1. Добавить поддержку `select`/`attributes` в запросах модели
2. Интегрировать выбор полей в систему фильтров
3. Уменьшить объём данных, передаваемых в фильтры
4. Обеспечить совместимость с Waterline и Sequelize

---

## Задачи

- [ ] 14.1 Расширить интерфейсы модели
- [ ] 14.1.1 Добавить `select?: string[]` в `FindOptions` (`AbstractModel.ts`)
- [ ] 14.1.2 Обновить адаптер Waterline для обработки `select`
- [ ] 14.1.3 Обновить адаптер Sequelize для обработки `attributes`

- [ ] 14.2 Модифицировать систему фильтров
- [ ] 14.2.1 Добавить `selectedFields?: string[]` в модель `FilterAP`
- [ ] 14.2.2 Обновить `FilterBuilder` для сохранения выбранных полей (`selectFields()`)
- [ ] 14.2.3 Модифицировать `FilterService` для применения выборки полей при выполнении фильтра

- [ ] 14.3 Интегрировать в QueryBuilder
- [ ] 14.3.1 Обновить `ModernQueryBuilder` для использования `selectedFields` из фильтра
- [ ] 14.3.2 Добавить логику применения выборки полей к запросам
- [ ] 14.3.3 Обеспечить fallback на все поля, если выборка не указана

- [ ] 14.4 UI компоненты
- [ ] 14.4.1 Реализовать интерфейс выбора полей в редакторе фильтров
- [ ] 14.4.2 Обновить отображение данных с учётом выбранных полей
- [ ] 14.4.3 Добавить валидацию выбранных полей

- [ ] 14.5 Тестирование и документация
- [ ] 14.5.1 Unit тесты для новой функциональности
- [ ] 14.5.2 Integration тесты для выборки полей
- [ ] 14.5.3 Обновить пользовательскую документацию

---

## Технические детали

### Интерфейсы

```typescript
interface FindOptions {
  populate?: PopulateOption[]
  limit?: number
  select?: string[]
}

interface FilterAP {
  // ... существующие поля
  selectedFields?: string[]
}
```

### Пример использования

```typescript
const filter = {
  name: 'Active Users',
  selectedFields: ['id', 'name', 'email'],
  conditions: [...]
}

const result = await model.find(criteria, {
  select: ['id', 'name', 'email']
})
```

### Совместимость с ORM

- Waterline: использовать `select` в критериях
- Sequelize: использовать `attributes` в опциях

---

## Риски и соображения

- Валидация существования полей должна выполняться до выполнения запроса
- Производительность при больших выборках и динамических наборах полей
- Кэширование выбранных полей в фильтрах
- Обратная совместимость с фильтрами без выборки полей
